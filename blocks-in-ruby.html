<!DOCTYPE html><html><head><meta content="text/html; charset=utf-8" http-equiv="Content-Type" /><meta content="width=device-width, initial-scale=1" name="viewport" /><!--replace-start-0--><!--replace-start-5--><!--replace-start-8--><title>Blocks in Ruby - エキソブレイン</title><!--replace-end-8--><!--replace-end-5--><!--replace-end-0--><link href="https://cdn.jsdelivr.net/npm/fomantic-ui@2.8.7/dist/semantic.min.css" rel="stylesheet" /><link href="https://fonts.googleapis.com/css?family=Merriweather|Libre+Franklin|Roboto+Mono&amp;display=swap" rel="stylesheet" /><!--replace-start-1--><!--replace-start-4--><!--replace-start-7--><link href="static/favicon.png" rel="icon" /><link href="static/apple-touch-icon.png" rel="apple-touch-icon" /><meta content="CyberFlamingo" name="author" /><meta content="Blocks are one way to achieve closure in Ruby. We can think of block as an anonymous method that is passed around and executed. And just like method, blocks return a value." name="description" /><link href="https://zettel.cyberflamingo.net/blocks-in-ruby" rel="canonical" /><meta content="Blocks in Ruby" property="og:title" /><meta content="エキソブレイン" property="og:site_name" /><meta content="article" property="og:type" /><meta content="blocks-in-ruby" property="neuron:zettel-id" /><meta content="blocks-in-ruby" property="neuron:zettel-slug" /><script type="application/ld+json">[{"@context":"https://schema.org","itemListElement":[{"name":"Learning Tracks","item":"https://zettel.cyberflamingo.net/97b2013b","@type":"ListItem","position":1},{"name":"Study Guide for Test","item":"https://zettel.cyberflamingo.net/3c3ba5a9","@type":"ListItem","position":2}],"@type":"BreadcrumbList"},{"@context":"https://schema.org","itemListElement":[{"name":"外付け脳 (exobrain)","item":"https://zettel.cyberflamingo.net","@type":"ListItem","position":1},{"name":"Computing","item":"https://zettel.cyberflamingo.net/cecb6a47","@type":"ListItem","position":2},{"name":"Software","item":"https://zettel.cyberflamingo.net/b6a0ce9f","@type":"ListItem","position":3},{"name":"Ruby","item":"https://zettel.cyberflamingo.net/f6590254","@type":"ListItem","position":4}],"@type":"BreadcrumbList"}]</script><style type="text/css">body{background-color:#eeeeee !important;font-family:"Libre Franklin", serif !important}body .ui.container{font-family:"Libre Franklin", serif !important}body h1, h2, h3, h4, h5, h6, .ui.header, .headerFont{font-family:"Merriweather", sans-serif !important}body code, pre, tt, .monoFont{font-family:"Roboto Mono","SFMono-Regular","Menlo","Monaco","Consolas","Liberation Mono","Courier New", monospace !important}body div.z-index p.info{color:#808080}body div.z-index ul{list-style-type:square;padding-left:1.5em}body div.z-index .uplinks{margin-left:0.29999em}body .zettel-content h1#title-h1{background-color:rgba(100,53,201,0.1)}body nav.bottomPane{background-color:rgba(100,53,201,2.0e-2)}body div#footnotes{border-top-color:#6435c9}body p{line-height:150%}body img{max-width:100%}body .deemphasized{font-size:0.94999em}body .deemphasized:hover{opacity:1}body .deemphasized:not(:hover){opacity:0.69999}body .deemphasized:not(:hover) a{color:#808080 !important}body div.container.universe{padding-top:1em}body div.zettel-view ul{padding-left:1.5em;list-style-type:square}body div.zettel-view .pandoc .highlight{background-color:#ffff00}body div.zettel-view .pandoc .ui.disabled.fitted.checkbox{margin-right:0.29999em;vertical-align:middle}body div.zettel-view .zettel-content .metadata{margin-top:1em}body div.zettel-view .zettel-content .metadata div.date{text-align:center;color:#808080}body div.zettel-view .zettel-content h1{padding-top:0.2em;padding-bottom:0.2em;text-align:center}body div.zettel-view .zettel-content h2{border-bottom:solid 1px #4682b4;margin-bottom:0.5em}body div.zettel-view .zettel-content h3{margin:0px 0px 0.4em 0px}body div.zettel-view .zettel-content h4{opacity:0.8}body div.zettel-view .zettel-content div#footnotes{margin-top:4em;border-top-style:groove;border-top-width:2px;font-size:0.9em}body div.zettel-view .zettel-content div#footnotes ol > li > p:only-of-type{display:inline;margin-right:0.5em}body div.zettel-view .zettel-content aside.footnote-inline{width:30%;padding-left:15px;margin-left:15px;float:right;background-color:#d3d3d3}body div.zettel-view .zettel-content .overflows{overflow:auto}body div.zettel-view .zettel-content code{margin:auto auto auto auto;font-size:100%}body div.zettel-view .zettel-content p code, li code, ol code{padding:0.2em 0.2em 0.2em 0.2em;background-color:#f5f2f0}body div.zettel-view .zettel-content pre{overflow:auto}body div.zettel-view .zettel-content dl dt{font-weight:bold}body div.zettel-view .zettel-content blockquote{background-color:#f9f9f9;border-left:solid 10px #cccccc;margin:1.5em 0px 1.5em 0px;padding:0.5em 10px 0.5em 10px}body div.zettel-view .zettel-content.raw{background-color:#dddddd}body .ui.label.zettel-tag{color:#000000}body .ui.label.zettel-tag a{color:#000000}body nav.bottomPane ul.backlinks > li{padding-bottom:0.4em;list-style-type:disc}body nav.bottomPane ul.context-list > li{list-style-type:lower-roman}body .footer-version img{-webkit-filter:grayscale(100%);-moz-filter:grayscale(100%);-ms-filter:grayscale(100%);-o-filter:grayscale(100%);filter:grayscale(100%)}body .footer-version img:hover{-webkit-filter:grayscale(0%);-moz-filter:grayscale(0%);-ms-filter:grayscale(0%);-o-filter:grayscale(0%);filter:grayscale(0%)}body .footer-version, .footer-version a, .footer-version a:visited{color:#808080}body .footer-version a{font-weight:bold}body .footer-version{margin-top:1em !important;font-size:0.69999em}@media only screen and (max-width: 768px){body div#zettel-container{margin-left:0.4em !important;margin-right:0.4em !important}}body span.zettel-link-container span.zettel-link a{color:#6435c9;font-weight:bold;text-decoration:none}body span.zettel-link-container span.zettel-link a:hover{background-color:rgba(100,53,201,0.1)}body span.zettel-link-container span.extra{color:auto}body span.zettel-link-container.errors{border:solid 1px #ff0000}body span.zettel-link-container.errors span.zettel-link a:hover{text-decoration:none !important;cursor:not-allowed}body [data-tooltip]:after{font-size:0.69999em}body div.tag-tree div.node{font-weight:bold}body div.tag-tree div.node a.inactive{color:#555555}body .tree.flipped{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}body .tree{overflow:auto}body .tree ul.root{padding-top:0px;margin-top:0px}body .tree ul{position:relative;padding:1em 0px 0px 0px;white-space:nowrap;margin:0px auto 0px auto;text-align:center}body .tree ul::after{content:"";display:table;clear:both}body .tree ul:last-child{padding-bottom:0.1em}body .tree li{display:inline-block;vertical-align:top;text-align:center;list-style-type:none;position:relative;padding:1em 0.5em 0em 0.5em}body .tree li::before{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{content:"";position:absolute;top:0px;right:50%;border-top:solid 2px #cccccc;width:50%;height:1.19999em}body .tree li::after{right:auto;left:50%;border-left:solid 2px #cccccc}body .tree li:only-child{padding-top:0em}body .tree li:only-child::after{display:none}body .tree li:only-child::before{display:none}body .tree li:first-child::before{border-style:none;border-width:0px}body .tree li:first-child::after{border-radius:5px 0px 0px 0px}body .tree li:last-child::after{border-style:none;border-width:0px}body .tree li:last-child::before{border-right:solid 2px #cccccc;border-radius:0px 5px 0px 0px}body .tree ul ul::before{content:"";position:absolute;top:0px;left:50%;border-left:solid 2px #cccccc;width:0px;height:1.19999em}body .tree li div.forest-link{border:solid 2px #cccccc;padding:0.2em 0.29999em 0.2em 0.29999em;text-decoration:none;display:inline-block;border-radius:5px 5px 5px 5px;color:#333333;position:relative;top:2px}body .tree.flipped li div.forest-link{-webkit-transform:rotate(180deg);-moz-transform:rotate(180deg);-ms-transform:rotate(180deg);-o-transform:rotate(180deg);transform:rotate(180deg)}</style><script async="" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/themes/prism.min.css" rel="stylesheet" /><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/components/prism-core.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.23.0/plugins/autoloader/prism-autoloader.min.js"></script><!--replace-end-7--><!--replace-end-4--><!--replace-end-1--></head><body><div class="ui fluid container universe"><!--replace-start-2--><!--replace-start-3--><!--replace-start-6--><nav class="flipped tree deemphasized" id="zettel-uptree" style="transform-origin: 50%"><ul class="root"><li><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-09-15T23:20"><a href="3c3ba5a9">Study Guide for Test</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-09-15T23:19"><a href="97b2013b">Learning Tracks</a></span></span></div></li></ul></li><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-08-02"><a href="f6590254">Ruby</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-08-02"><a href="b6a0ce9f">Software</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link" title="2020-08-02"><a href="cecb6a47">Computing</a></span></span></div><ul><li><div class="forest-link"><span class="zettel-link-container"><span class="zettel-link"><a href=".">外付け脳 (exobrain)</a></span></span></div></li></ul></li></ul></li></ul></li></ul></li></ul></nav><div class="ui text container" id="zettel-container" style="position: relative"><div class="zettel-view"><article class="ui raised attached segment zettel-content"><div class="pandoc"><h1 id="title-h1">Blocks in Ruby</h1><p>Blocks are one way to achieve <span class="zettel-link-container folge"><span class="zettel-link" title="2021-06-09T09:33"><a href="closure">Closure</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span> in Ruby. We can think of block as an anonymous method that is passed around and executed. And just like method, blocks return a value.</p><p>In Ruby, method implicitly accepts blocks. The execution of the block is done through <span class="zettel-link-container folge"><span class="zettel-link" title="2021-06-09T10:14"><a href="yielding">Yielding</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span>.</p><h2 id="arity">Arity</h2><p>Passing less or more block argument than expected parameter does not produce an error.</p><p>The rules regarding this number of arguments that can be passed to a block (or a <code>Proc</code> or <code>lambda</code>) is called its <strong>arity</strong>. In Ruby, blocks have <em>lenient arity</em> rules. It means it won’t complain if the number of arguments is not the same as the number of parameters defined.</p><h2 id="when-to-use-blocks-in-a-method">When to use Blocks in a Method</h2><h3 id="defere-the-implementation-to-method-invocation">Defere the Implementation to Method Invocation</h3><p>In some case, we are not sure how the method will be called. In those case, instead of implementing a method with perhaps a flag to control the flow, one can make use of a block. This is actually how most core library’s methods are implemented: <code>Array#select</code> lets you pass in any expression that evaluates to a boolean in the block parameter. This is much more convenient than having a <code>select_*</code> method for every case possible (one when the number is <em>odds</em>, one when the number is <em>greater than</em>, one when it’s <em>prime</em> etc.)</p><h3 id="sandwich-code-">Sandwich Code 🥪</h3><p>Useful to execute a code before and after anything. Sandwich code is often used with timing execution, logging, notification systems etc. It is also used in resource management and interfacing with operating system: allocate resources then perform clean-up to free up said resources.</p><pre><code class="ruby language-ruby">def time_it
  time_before = Time.now
  yield
  time_after = Time.now

  puts &quot;It took #{time_after - time_before} seconds.&quot;
end

time_it { sleep(3) }

time_it { &quot;hello world&quot; }</code></pre><p>Ruby’s own <code>File#open</code> method can take a block. Doing so let the method open then close a file automatically for us!</p><pre><code class="ruby language-ruby">File.open(&#39;file.txt&#39;, &#39;w+&#39;) do |file|
  # write something in the file
end</code></pre><p>Here, Ruby automatically opens the file, do whatever we instruct it to do in the block and finally closes the file. This is better than having to call <code>File#close</code>!</p><h2 id="explicit-block-parameter">Explicit Block Parameter</h2><p>Ruby methods implicitly accept block. If there is no yielding done, the block is simply ignored. It is also possible to explicitly take a block.</p><p>An explicit block is treated <strong>as a named object</strong>: it gets assigned to a method parameter and can be managed like any other object.</p><p>An explicit block is named with a <code>&amp;</code> following by the name.</p><pre><code class="ruby language-ruby">def method(&amp;explicit_block)
  puts &quot;My &amp;explicit_block is: #{explicit_block}&quot;
end

method { sleep(2) }
# My &amp;explicit_block is: #&lt;Proc:0x000055d1e7dcf050 block.rb:5&gt;
# =&gt; nil</code></pre><p>The <code>explicit_block</code> local variable pointing to our explicit block is converted by Ruby to a simple <code>Proc</code> object. The details of what is a <code>Proc</code> is trifling as of yet but knowing it is a <code>Proc</code> is important for invoking it further down the road with <code>Proc#call</code> method (see below).</p><div class="ui message info"><p>Method with an explicit block are defined with a special parameter starting with an <code>&amp;</code> but it is dropped when referring to the parameter inside the method.</p></div><p>The point of an explicit block is to be able to use it like any other variable. That means we can pass the block around to another method, if need arises.</p><pre><code class="ruby language-ruby">def method(&amp;block)
  puts &quot;Do something...&quot;
  method2(block)         # Call `method2` passing in local variable `block`
  puts &quot;Goodbye&quot;
end

def method2(local_var)
  puts &quot;In method2!&quot;
  local_var.call(&quot;=&gt; &quot;)  # calls the block originally passed to `method`
  puts &quot;Let&#39;s go back to method&quot;
end

method do |prefix|
  puts prefix + &quot;Wait 2 seconds and continue...&quot;
  sleep(2)
end
# Do something...
# In method2!
# =&gt; Wait 2 seconds and continue...
# Let&#39;s go back to method
# Goodbye</code></pre><p>A <code>Proc</code> is not called with <code>yield</code> like the implicit block we saw earlier. Instead, to call a <code>Proc</code> we use the aptly named <code>call</code> method. Another thing to keep in mind is that we can pass arguments to the explicit block by using them as arguments to <code>call</code>. The argument is used only if a parameter is defined in the block.</p></div><div class="metadata"><div class="date" title="Zettel date"><time datetime="2021-06-10T08:37">2021-06-10</time></div></div></article><nav class="ui attached segment deemphasized backlinksPane" id="neuron-backlinks-pane"><h3 class="ui header"><span title="Backlinks from folgezettel parents">Uplinks</span></h3><ul class="backlinks"><li><span class="zettel-link-container folge"><span class="zettel-link" title="2020-09-15T23:20"><a href="3c3ba5a9">Study Guide for Test</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><span class="zettel-link-container folge"><span class="zettel-link" title="2021-06-10T08:37"><a href="blocks-in-ruby">Blocks in Ruby</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span></div></li></ul></li><li><span class="zettel-link-container folge"><span class="zettel-link" title="2020-08-02"><a href="f6590254">Ruby</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span><ul class="context-list" style="zoom: 85%;"><li class="item"><div class="pandoc"><span class="zettel-link-container folge"><span class="zettel-link" title="2021-06-10T08:37"><a href="blocks-in-ruby">Blocks in Ruby</a><span data-nosnippet="" style="user-select: none; color: gray" title="Folgezettel">#</span></span></span></div></li></ul></li></ul></nav><nav class="ui bottom attached icon compact inverted menu violet" id="neuron-nav-bar"><!--replace-start-9--><a class="item" href="." title="Home"><i class="home icon"></i></a><!--replace-end-9--><a class="item" href="https://github.com/cyberflamingo/exobrain/edit/master/./blocks-in-ruby.md" title="Edit this page"><i class="edit icon"></i></a><a class="right item" href="impulse" title="Open Impulse"><i class="wave square icon"></i></a></nav></div></div><!--replace-end-6--><!--replace-end-3--><!--replace-end-2--><div class="ui center aligned container footer-version"><div class="ui tiny image"><a href="https://neuron.zettel.page"><img alt="logo" src="https://raw.githubusercontent.com/srid/neuron/master/assets/neuron.svg" title="Generated by Neuron 1.9.35.0" /></a></div></div></div></body></html>