<!DOCTYPE html>
<!-- TODO: Main navigation links (Home, index, tags, ...) --><!-- DoNotFormat -->
<!-- DoNotFormat -->

<html lang='en'>

<head>
  <meta charset='UTF-8' />
  <meta name='viewport' content='width=device-width, initial-scale=1' />
  <title>
    Blocks in Ruby ‚Äì „Ç®„Ç≠„ÇΩ„Éñ„É¨„Ç§„É≥
  </title>
  
    
      <meta property='og:description' content='Blocks are one way to achieve [[closure]] in Ruby. We can think of block as an anonymous method that is passed around and executed. And just like method, blocks return a value.' />
      <meta property='og:site_name' content='„Ç®„Ç≠„ÇΩ„Éñ„É¨„Ç§„É≥' />
      <meta property='og:image' content />
      <meta property='og:type' content='website' />
      <meta property='og:title' content='Blocks in Ruby' />
    
    
      <base href='/' />
      <link href='favicon.svg' rel='icon' />
    
    <!-- highlight.js -->
<link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/styles/hybrid.min.css' />
<script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/highlight.min.js'></script>
<!-- Include languages that Emanote itself uses -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/haskell.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.6.0/languages/nix.min.js'></script>
<script>hljs.highlightAll();</script>



  
  <link href='tailwind.css?instanceId=03d3f36a-651a-43d9-93c0-e30d8f9a9647' rel='stylesheet' type='text/css' />

  <style>
    /* Heist error element */
    strong.error {
      color: lightcoral;
      font-size: 90%;
      font-family: monospace;
    }

    /* External link icon */
    a[data-linkicon]:not([data-linkicon=""]):not([data-linkicon="none"])::after {
      /* filter converts black to rgb(156,163,175) */
      filter: invert(71%) sepia(3%) saturate(904%) hue-rotate(179deg) brightness(92%) contrast(87%);
      margin-left: 1px;
    }

    a[data-linkicon]:not([data-linkicon=""]):not([data-linkicon="none"]):hover::after {
      /* filter converts black to  rgb(175,85,99) */
      filter: invert(32%) sepia(10%) saturate(834%) hue-rotate(176deg) brightness(92%) contrast(88%);
    }

    a[data-linkicon=""]::after {
      content: ""
    }

    a[data-linkicon=none]::after {
      content: ""
    }

    a[data-linkicon="external"]::after {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' fill='none' viewBox='0 0 24 24' stroke='black' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14' /%3E%3C/svg%3E");
    }

    a[data-linkicon="external"][href^="mailto:"]::after {
      content: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' height='1em' fill='none' viewBox='0 0 24 24' stroke='black' stroke-width='2'%3E%3Cpath stroke-linecap='round' stroke-linejoin='round' d='M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z' /%3E%3C/svg%3E");
    }
  </style>
  <!-- What goes in this file will appear on near the end of <head>--><link rel='preload' href='_emanote-static/fonts/Work_Sans/WorkSans-VariableFont_wght.ttf' as='font' type='font/ttf' crossorigin />

<style>
  @font-face {
    font-family: 'WorkSans';
    /* FIXME: This ought to be: ${ema:emanoteStaticLayerUrl}/fonts/Work_Sans/WorkSans-VariableFont_wght.ttf */
    src: url(_emanote-static/fonts/Work_Sans/WorkSans-VariableFont_wght.ttf) format("truetype");
    font-display: swap;
  }

  body {
    font-family: 'WorkSans', sans-serif;
    font-variation-settings: 'wght' 350;
  }

  a.mavenLinkBold {
    font-variation-settings: 'wght' 400;
  }

  strong {
    font-variation-settings: 'wght' 500;
  }

  h1,
  h2,
  h3,
  h4,
  h5,
  h6,
  header,
  .header-font {
    font-family: 'WorkSans', sans-serif;
  }

  h1 {
    font-variation-settings: 'wght' 500;
  }

  h2 {
    font-variation-settings: 'wght' 400;
  }

  h3 {
    font-variation-settings: 'wght' 300;
  }
</style>


  
    <link rel='stylesheet' href='_emanote-static/inverted-tree.css' />
  
  <link rel='stylesheet' href='_emanote-static/stork/flat.css' />
<!-- Custom Stork-search styling for Emanote -->
<style>
  #stork-search-container {
    z-index: 1000;
    background-color: rgb(15 23 42/.8);
  }

  .stork-overflow-hidden-important {
    overflow: hidden !important;
  }
</style>


<script src='_emanote-static/stork/stork.js'></script>

  
    <script data-emanote-base-url='/'>
      window.emanote = {};
      window.emanote.stork = {
        searchShown: false,
        toggleSearch: function () {
          document.getElementById('stork-search-container').classList.toggle('hidden');
          window.emanote.stork.searchShown = document.body.classList.toggle('stork-overflow-hidden-important');
          if (window.emanote.stork.searchShown) {
            document.getElementById('stork-search-input').focus();
          }
        },
        clearSearch: function () {
          document.getElementById('stork-search-container').classList.add('hidden');
          document.body.classList.remove('stork-overflow-hidden-important');
          window.emanote.stork.searchShown = false;
        },

        init: function () {
          const indexName = 'emanote-search'; // used to match input[data-stork] attribute value
          const baseUrl = document.currentScript.getAttribute('data-emanote-base-url') || '/';
          const indexUrl = baseUrl + '-/stork.st';
          if (document.readyState !== 'complete') {
            window.addEventListener('load', function () {
              stork.initialize(baseUrl + '_emanote-static/stork/stork.wasm');
              stork.register(indexName, indexUrl);
            });

            document.addEventListener('keydown', event => {
              if (window.emanote.stork.searchShown && event.key === 'Escape') {
                window.emanote.stork.clearSearch();
                event.preventDefault();
              } else if ((event.key == 'k' || event.key == 'K') && (event.ctrlKey || event.metaKey)) {
                window.emanote.stork.toggleSearch();
                event.preventDefault();
              }
            });
          } else {
            // Override existing on Ema's hot-reload
            stork.register(indexName, indexUrl, { forceOverwrite: true });
          }
        }
      };

      window.emanote.stork.init();
    </script>
  

</head>

<!-- DoNotFormat -->



<!-- DoNotFormat -->

<body class='bg-gray-400 overflow-y-scroll'>
  
    <div class='container mx-auto max-w-prose'>
      <div class='mt-2 md:mt-4'>
        <!-- DoNotFormat -->
<!-- DoNotFormat -->

<nav id='uptree' class='flipped tree' style='transform-origin: 50%;'>
  <ul class='root'>
    <li>
      
        <ul>
          
            <li>

  <div class='text-gray-900 forest-link'>
    <a href='computing/software/ruby'>
      Ruby
    </a>
  </div>

  
    <ul>
      
        <li>

  <div class='text-gray-900 forest-link'>
    <a href='computing/software'>
      Software
    </a>
  </div>

  
    <ul>
      
        <li>

  <div class='text-gray-900 forest-link'>
    <a href='computing'>
      Computing
    </a>
  </div>

  
    <ul>
      
        <li>

  <div class='text-gray-900 forest-link'>
    <a href=''>
      Â§ñ‰ªò„ÅëËÑ≥ (exobrain)
    </a>
  </div>

  
</li>
      
    </ul>
  
</li>
      
    </ul>
  
</li>
      
    </ul>
  
</li>
          
        </ul>
      
    </li>
  </ul>
</nav>

        <div class='relative md:shadow-2xl md:mb-8'>

          <div class='absolute -top-6 right-1 md:right-0 flex flex-row items-center justify-center'>
            <a title='Search (Ctrl+K)' class='cursor-pointer' onclick='window.emanote.stork.toggleSearch()'>
              <svg xmlns='http://www.w3.org/2000/svg' style='width: 1rem;' class='hover:text-violet-700' f
 fill='none' viewBox='0 0 24 24' stroke='currentColor' stroke-width='2'>
  <path stroke-linecap='round' stroke-linejoin='round' d='M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z'></path>
</svg>
            </a>
          </div>
          <div class='flex-1 w-full overflow-x-auto bg-white'>
            <main class='px-4 py-4'>
              <h1 class='flex items-end justify-center mb-4 p-3 bg-violet-100 text-5xl font-extrabold text-black rounded'>
  <a class='z-40 tracking-tighter '>
    Blocks in Ruby
  </a>
</h1>
              <article class='overflow-auto'>
  <!-- What goes in this file will appear on top of note body-->
  
    <p class='mb-3'>
      Blocks are one way to achieve <a href='computing/software/closure' class='text-violet-600 mavenLinkBold hover:underline' data-wikilink-type='WikiLinkBranch'>Closure</a> in Ruby. We can think of block as an anonymous method that is passed around and executed. And just like method, blocks return a value.
    </p>
  
    <p class='mb-3'>
      In Ruby, method implicitly accepts blocks. The execution of the block is done through <a href='computing/software/yielding' class='text-violet-600 mavenLinkBold hover:underline' data-wikilink-type='WikiLinkBranch'>Yielding</a>.
    </p>
  <h2 id='arity' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>Arity</h2>
    <p class='mb-3'>
      Passing less or more block argument than expected parameter does not produce an error.
    </p>
  
    <p class='mb-3'>
      The rules regarding this number of arguments that can be passed to a block (or a <code class='py-0.5 px-0.5 bg-gray-100'>Proc</code> or <code class='py-0.5 px-0.5 bg-gray-100'>lambda</code>) is called its <strong>arity</strong>. In Ruby, blocks have <em>lenient arity</em> rules. It means it won‚Äôt complain if the number of arguments is not the same as the number of parameters defined.
    </p>
  <h2 id='when-to-use-blocks-in-a-method' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>When to use Blocks in a Method</h2><h3 id='defere-the-implementation-to-method-invocation' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Defere the Implementation to Method Invocation</h3>
    <p class='mb-3'>
      In some case, we are not sure how the method will be called. In those case, instead of implementing a method with perhaps a flag to control the flow, one can make use of a block. This is actually how most core library‚Äôs methods are implemented: <code class='py-0.5 px-0.5 bg-gray-100'>Array#select</code> lets you pass in any expression that evaluates to a boolean in the block parameter. This is much more convenient than having a <code class='py-0.5 px-0.5 bg-gray-100'>select_*</code> method for every case possible (one when the number is <em>odds</em>, one when the number is <em>greater than</em>, one when it‚Äôs <em>prime</em> etc.)
    </p>
  <h3 id='sandwich-code-' class='mt-6 mb-2 text-3xl font-bold text-gray-700'>Sandwich Code ü•™</h3>
    <p class='mb-3'>
      Useful to execute a code before and after anything. Sandwich code is often used with timing execution, logging, notification systems etc. It is also used in resource management and interfacing with operating system: allocate resources then perform clean-up to free up said resources.
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='ruby language-ruby'>def time_it
  time_before = Time.now
  yield
  time_after = Time.now

  puts "It took #{time_after - time_before} seconds."
end

time_it { sleep(3) }

time_it { "hello world" }</code></pre></div>
    <p class='mb-3'>
      Ruby‚Äôs own <code class='py-0.5 px-0.5 bg-gray-100'>File#open</code> method can take a block. Doing so let the method open then close a file automatically for us!
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='ruby language-ruby'>File.open('file.txt', 'w+') do |file|
  # write something in the file
end</code></pre></div>
    <p class='mb-3'>
      Here, Ruby automatically opens the file, do whatever we instruct it to do in the block and finally closes the file. This is better than having to call <code class='py-0.5 px-0.5 bg-gray-100'>File#close</code>!
    </p>
  <h2 id='explicit-block-parameter' class='inline-block mt-6 mb-4 text-4xl font-bold text-gray-700 border-b-2'>Explicit Block Parameter</h2>
    <p class='mb-3'>
      Ruby methods implicitly accept block. If there is no yielding done, the block is simply ignored. It is also possible to explicitly take a block.
    </p>
  
    <p class='mb-3'>
      An explicit block is treated <strong>as a named object</strong>: it gets assigned to a method parameter and can be managed like any other object.
    </p>
  
    <p class='mb-3'>
      An explicit block is named with a <code class='py-0.5 px-0.5 bg-gray-100'>&</code> following by the name.
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='ruby language-ruby'>def method(&explicit_block)
  puts "My &explicit_block is: #{explicit_block}"
end

method { sleep(2) }
# My &explicit_block is: #&lt;Proc:0x000055d1e7dcf050 block.rb:5&gt;
# =&gt; nil</code></pre></div>
    <p class='mb-3'>
      The <code class='py-0.5 px-0.5 bg-gray-100'>explicit_block</code> local variable pointing to our explicit block is converted by Ruby to a simple <code class='py-0.5 px-0.5 bg-gray-100'>Proc</code> object. The details of what is a <code class='py-0.5 px-0.5 bg-gray-100'>Proc</code> is trifling as of yet but knowing it is a <code class='py-0.5 px-0.5 bg-gray-100'>Proc</code> is important for invoking it further down the road with <code class='py-0.5 px-0.5 bg-gray-100'>Proc#call</code> method (see below).
    </p>
  <div class='ui message info'>
    <p class='mb-3'>
      Method with an explicit block are defined with a special parameter starting with an <code class='py-0.5 px-0.5 bg-gray-100'>&</code> but it is dropped when referring to the parameter inside the method.
    </p>
  </div>
    <p class='mb-3'>
      The point of an explicit block is to be able to use it like any other variable. That means we can pass the block around to another method, if need arises.
    </p>
  <div class='py-0.5 mb-3 text-sm'><pre><code class='ruby language-ruby'>def method(&block)
  puts "Do something..."
  method2(block)         # Call `method2` passing in local variable `block`
  puts "Goodbye"
end

def method2(local_var)
  puts "In method2!"
  local_var.call("=&gt; ")  # calls the block originally passed to `method`
  puts "Let's go back to method"
end

method do |prefix|
  puts prefix + "Wait 2 seconds and continue..."
  sleep(2)
end
# Do something...
# In method2!
# =&gt; Wait 2 seconds and continue...
# Let's go back to method
# Goodbye</code></pre></div>
    <p class='mb-3'>
      A <code class='py-0.5 px-0.5 bg-gray-100'>Proc</code> is not called with <code class='py-0.5 px-0.5 bg-gray-100'>yield</code> like the implicit block we saw earlier. Instead, to call a <code class='py-0.5 px-0.5 bg-gray-100'>Proc</code> we use the aptly named <code class='py-0.5 px-0.5 bg-gray-100'>call</code> method. Another thing to keep in mind is that we can pass arguments to the explicit block by using them as arguments to <code class='py-0.5 px-0.5 bg-gray-100'>call</code>. The argument is used only if a parameter is defined in the block.
    </p>
  

  <div class='flex items-center justify-center mt-2'>
  
    
      <a class='text-gray-300 hover:text-violet-600 text-sm' title='Edit this page on GitHub' href='${value:editBaseUrl}/computing/software/ruby/blocks-in-ruby.md'>
        <svg xmlns='http://www.w3.org/2000/svg' class='h-6 w-6' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
          <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z'></path>
        </svg>
      </a>
    
  
</div>
</article>
              <div class='flex flex-col lg:flex-row lg:space-x-2'>
                
                
  <div class='flex-1 p-4 mt-8 bg-gray-100 rounded'>
    <header class='mb-2 text-xl font-semibold text-gray-500'>Links to this page</header>
    <ul class='space-y-1'>
      
        <li>
          <a class='text-violet-600 mavenLinkBold hover:bg-violet-50' href='computing/software/ruby/learning-tracks/study-guide-test'>
            Study Guide for Test
          </a>
          
            <div class='mb-4 overflow-auto text-sm text-gray-500'>
  
    <div class='pl-2 mt-2 border-l-2 border-violet-200 hover:border-violet-500'>
      <div><a href='computing/software/ruby/blocks-in-ruby' class='text-gray-600 font-bold hover:bg-gray-50' data-wikilink-type='WikiLinkNormal'>Blocks in Ruby</a></div>
    </div>
  
</div>
          
        </li>
      
        <li>
          <a class='text-violet-600 mavenLinkBold hover:bg-violet-50' href='computing/software/ruby'>
            Ruby
          </a>
          
            <div class='mb-4 overflow-auto text-sm text-gray-500'>
  
    <div class='pl-2 mt-2 border-l-2 border-violet-200 hover:border-violet-500'>
      <div><a href='computing/software/ruby/blocks-in-ruby' class='text-gray-600 font-bold hover:bg-gray-50' data-wikilink-type='WikiLinkBranch'>Blocks in Ruby</a></div>
    </div>
  
</div>
          
        </li>
      
    </ul>
  </div>

              </div>
              
  <section class='flex flex-wrap items-end justify-center my-4 space-x-2 space-y-2 font-mono text-sm'>
    
  </section>

              <div class='flex items-center justify-end pb-3'>
  
    <time class='p-2 text-sm text-gray-500' datetime='<!-- TODO -->'>
      2021-06-10T08:37
    </time>
  
</div>

            </main>
          </div>
        </div>
        <footer class='flex items-center justify-center mt-2 mb-8 space-x-4 text-center text-gray-800'>
  
  <div>
    <a href='' title='Go to Home page'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 hover:text-violet-700' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6'></path>
      </svg>
    </a>
  </div>
  <div>
    <a href='-/all' title='View Index'>
      <svg class='w-6 h-6 hover:text-violet-700' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4'>
        </path>
      </svg>
    </a>
  </div>
  <div>
    <a href='https://emanote.srid.ca' target='_blank' title='Generated by Emanote 0.8.1.10'>
      <img class='w-6 h-6 hover:text-violet-700' src='_emanote-static/emanote-logo.svg' />
    </a>
  </div>
  <div>
    <a href='-/tags' title='View tags'>
      <svg class='w-6 h-6 hover:text-violet-700' fill='none' stroke='currentColor' viewBox='0 0 24 24' xmlns='http://www.w3.org/2000/svg'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z'>
        </path>
      </svg>
    </a>
  </div>
  <div>
    <a href='-/tasks' title='View tasks'>
      <svg xmlns='http://www.w3.org/2000/svg' class='w-6 h-6 hover:text-violet-700' fill='none' viewBox='0 0 24 24' stroke='currentColor'>
        <path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z'></path>
      </svg>
    </a>
  </div>
</footer>
      </div>
    </div>
  
  <div id='stork-search-container' class='hidden fixed w-screen h-screen inset-0 backdrop-filter backdrop-blur-sm'>
  <div class='fixed w-screen h-screen inset-0' onclick='window.emanote.stork.toggleSearch()'></div>

  <div class='container mx-auto p-10 mt-10'>
    <div class='stork-wrapper-flat container mx-auto'>
      <input id='stork-search-input' data-stork='emanote-search' class='stork-input' placeholder='Search (Ctrl+K) ...' />
      <div data-stork='emanote-search-output' class='stork-output'></div>
    </div>
  </div>
</div>
  
    
  
</body>

</html>